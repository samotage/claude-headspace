{% extends "base.html" %}

{% block title %}Objective - Claude Headspace{% endblock %}

{% block content %}
<div class="min-h-screen">
    <!-- Simple header for objective page -->
    <header class="bg-deep border-b border-border sticky top-0 z-50" role="banner">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between py-4">
                <h1 class="text-xl font-bold text-primary">
                    <span class="text-cyan">CLAUDE</span> <span class="text-muted">&gt;_</span>headspace
                </h1>

                <nav class="flex gap-4" role="navigation" aria-label="Main navigation">
                    <a href="{{ url_for('dashboard.dashboard') }}"
                       class="px-4 py-2 rounded text-secondary hover:text-primary hover:bg-hover transition-colors min-h-[44px] flex items-center">
                        dashboard
                    </a>
                    <a href="{{ url_for('objective.objective_page') }}"
                       class="px-4 py-2 rounded bg-surface text-primary hover:bg-hover transition-colors min-h-[44px] flex items-center"
                       aria-current="page">
                        objective
                    </a>
                    <a href="#"
                       class="px-4 py-2 rounded text-secondary hover:text-primary hover:bg-hover transition-colors min-h-[44px] flex items-center">
                        logging
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6" role="main">
        <!-- Objective Form Section -->
        <section class="mb-8" aria-labelledby="objective-form-heading">
            <div class="bg-elevated rounded-lg border border-border p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="objective-form-heading" class="text-lg font-bold text-primary">Current Objective</h2>
                    <div id="save-status" class="text-sm text-muted" role="status" aria-live="polite">
                        <!-- Status will be updated by JavaScript -->
                    </div>
                </div>

                <form id="objective-form" class="space-y-4">
                    <!-- Objective text field -->
                    <div>
                        <label for="objective-text" class="block text-sm text-secondary mb-2">
                            Objective <span class="text-red">*</span>
                        </label>
                        <input type="text"
                               id="objective-text"
                               name="text"
                               class="w-full px-4 py-3 bg-surface border border-border rounded text-primary placeholder-muted focus:border-cyan focus:outline-none transition-colors"
                               placeholder="What's your objective right now?"
                               value="{{ objective.current_text if objective else '' }}"
                               required
                               aria-describedby="objective-hint">
                        <p id="objective-hint" class="mt-1 text-xs text-muted">
                            Changes save automatically
                        </p>
                    </div>

                    <!-- Constraints field -->
                    <div>
                        <label for="objective-constraints" class="block text-sm text-secondary mb-2">
                            Constraints <span class="text-muted">(optional)</span>
                        </label>
                        <textarea id="objective-constraints"
                                  name="constraints"
                                  rows="3"
                                  class="w-full px-4 py-3 bg-surface border border-border rounded text-primary placeholder-muted focus:border-cyan focus:outline-none transition-colors resize-y"
                                  placeholder="Any constraints or boundaries to keep in mind?">{{ objective.constraints if objective and objective.constraints else '' }}</textarea>
                    </div>
                </form>

                {% if objective and objective.set_at %}
                <div class="mt-4 pt-4 border-t border-border">
                    <p class="text-xs text-muted">
                        Last updated: <time datetime="{{ objective.set_at.isoformat() }}">{{ objective.set_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}</time>
                    </p>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- Objective History Section -->
        <section aria-labelledby="history-heading">
            <div class="bg-elevated rounded-lg border border-border p-6">
                <h2 id="history-heading" class="text-lg font-bold text-primary mb-4">Objective History</h2>

                {% if history %}
                <div id="history-list" class="space-y-4">
                    {% for item in history %}
                    <article class="p-4 bg-surface rounded border border-border">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <p class="text-primary break-words">{{ item.text }}</p>
                                {% if item.constraints %}
                                <p class="mt-2 text-sm text-secondary break-words">
                                    <span class="text-muted">Constraints:</span> {{ item.constraints }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="mt-3 flex flex-wrap gap-4 text-xs text-muted">
                            <span>
                                Started: <time datetime="{{ item.started_at.isoformat() }}">{{ item.started_at.strftime('%Y-%m-%d %H:%M') }}</time>
                            </span>
                            {% if item.ended_at %}
                            <span>
                                Ended: <time datetime="{{ item.ended_at.isoformat() }}">{{ item.ended_at.strftime('%Y-%m-%d %H:%M') }}</time>
                            </span>
                            {% else %}
                            <span class="text-cyan">Current</span>
                            {% endif %}
                        </div>
                    </article>
                    {% endfor %}
                </div>

                {% if has_more %}
                <div class="mt-4 text-center">
                    <button id="load-more-btn"
                            class="px-6 py-2 bg-surface border border-border rounded text-secondary hover:text-primary hover:border-cyan transition-colors min-h-[44px]"
                            data-page="2"
                            data-total="{{ total_history }}">
                        Load more
                    </button>
                </div>
                {% endif %}
                {% else %}
                <div id="empty-history" class="text-center py-8">
                    <p class="text-secondary">No objective history yet.</p>
                    <p class="text-muted text-sm mt-1">Set your first objective above to get started.</p>
                </div>
                {% endif %}
            </div>
        </section>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/objective.js') }}"></script>
{% endblock %}
