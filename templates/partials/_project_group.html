<section class="bg-surface rounded-lg border border-border overflow-hidden"
         data-project-id="{{ project.id }}"
         aria-labelledby="project-{{ project.id }}-heading">
    <!-- Project header -->
    <div class="flex items-center justify-between p-4 bg-elevated cursor-pointer hover:bg-hover transition-colors min-h-[44px]"
         hx-get="#"
         hx-swap="none"
         onclick="this.parentElement.querySelector('.project-content').classList.toggle('hidden')"
         role="button"
         tabindex="0"
         aria-expanded="true"
         aria-controls="project-{{ project.id }}-content"
         onkeypress="if(event.key==='Enter'||event.key===' '){this.click();event.preventDefault();}">

        <div class="flex items-center gap-3">
            <!-- Traffic light -->
            {% if project.traffic_light == 'red' %}
                <span class="traffic-light w-3 h-3 rounded-full bg-red"
                      role="status"
                      aria-label="Needs attention - agent awaiting input"></span>
            {% elif project.traffic_light == 'yellow' %}
                <span class="traffic-light w-3 h-3 rounded-full bg-amber"
                      role="status"
                      aria-label="Working - agents processing"></span>
            {% else %}
                <span class="traffic-light w-3 h-3 rounded-full bg-green"
                      role="status"
                      aria-label="All good - agents idle or complete"></span>
            {% endif %}

            <!-- Project name -->
            <h2 id="project-{{ project.id }}-heading" class="text-primary font-medium">
                {{ project.name }}
            </h2>
        </div>

        <!-- Active agent count -->
        <div class="flex items-center gap-2">
            <span class="text-secondary text-sm">
                [{{ project.active_count }} active]
            </span>
            <span class="text-muted">
                <svg class="w-4 h-4 transform transition-transform project-chevron"
                     fill="none" stroke="currentColor" viewBox="0 0 24 24"
                     aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </span>
        </div>
    </div>

    <!-- Project content (collapsible) -->
    <div id="project-{{ project.id }}-content" class="project-content">
        <!-- Waypoint preview (if available) -->
        {% if project.waypoint %}
        <div class="px-4 py-2 border-t border-border bg-deep flex items-center gap-2">
            <span class="text-muted text-sm">â–¶</span>
            <span class="text-secondary text-sm truncate flex-1">
                Waypoint: {{ project.waypoint }}
            </span>
            <button class="text-cyan text-sm hover:text-primary min-h-[44px] min-w-[44px] flex items-center justify-center"
                    disabled>
                [Edit]
            </button>
        </div>
        {% endif %}

        <!-- Agent cards grid -->
        <div class="p-4 border-t border-border">
            {% if project.agents %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for agent in project.agents %}
                        {% include "partials/_agent_card.html" %}
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted text-center py-4">No agents in this project.</p>
            {% endif %}
        </div>
    </div>
</section>
